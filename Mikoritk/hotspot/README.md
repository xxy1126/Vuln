# vuln 

The `hotspot` process has a memory corruption vulnerability. By sending crafted packets, remote users  can crash `hotspot` processes due to NULL pointer dereference.

```
# cat /rw/logs/backtrace.log
2023.02.25-23:59:47.20@0: /pckg/hotspot/nova/bin/hotspot 
2023.02.25-23:59:47.20@0:
2023.02.25-23:59:47.20@0:
2023.02.25-23:59:47.20@0: 77785000-777d1000 r-xp 00000000 00:0b 981        /lib/libumsg.so
2023.02.25-23:59:47.20@0: 777d4000-777dc000 r-xp 00000000 00:0b 985        /lib/libubox.so
2023.02.25-23:59:47.20@0: 777e0000-777e7000 r-xp 00000000 00:0b 994        /lib/ld-uClibc-0.9.33.2.so
2023.02.25-23:59:47.20@0:
2023.02.25-23:59:47.20@0: stack: 0x7fcdc000 - 0x7fcdb02c
2023.02.25-23:59:47.20@0: d4 b0 cd 7f 80 4e 0f 08 08 00 00 00 a0 62 0f 08 a6 62 0f 08 58 ee 07 08 00 00 00 00 68 b0 cd 7f
2023.02.25-23:59:47.20@0: f0 ca 7d 77 80 4e 0f 08 d4 b0 cd 7f 88 b0 cd 7f 7c 7a 7d 77 80 4e 0f 08 d4 b0 cd 7f 05 00 00 00
2023.02.25-23:59:47.20@0:
2023.02.25-23:59:47.20@0: code: 0x805cc6b
2023.02.25-23:59:47.20@0: ff 70 04 6a 07 56 e8 4a 14 ff ff 8b 43 78 83 c4
2023.02.25-23:59:47.20@0:
2023.02.25-23:59:47.20@0: backtrace: 0x0805cc6b 0x777d7a7c 0x777db0c6 0x777acd80 0x777a98aa 0x777abe6e 0x777ab3fb 0x777a7163 0x777a71bb 0x777ade1b 0x0804f977 0x77738fcb 0x08050c99
2023.02.25-23:59:47.20@0: extra 0x7fcdb1dc
2023.02.25-23:59:47.20@0: virtual void nv::Looper::dispatchMessage(nv::message&)
2023.02.25-23:59:47.20@0: Handler: 0x00000008
2023.02.25-23:59:47.20@0: true--- nv::message --------
2023.02.25-23:59:47.20@0:  bool [1061]=false
2023.02.25-23:59:47.20@0:  bool [6]=true
2023.02.25-23:59:47.20@0:  bool [8]=false
2023.02.25-23:59:47.20@0:  bool [13]=true
2023.02.25-23:59:47.20@0:  bool [101]=true
2023.02.25-23:59:47.20@0:  bool [102]=true
2023.02.25-23:59:47.20@0:  bool [24]=true
2023.02.25-23:59:47.20@0:  bool [25]=true
2023.02.25-23:59:47.20@0:  bool [202]=false
2023.02.25-23:59:47.20@0:  bool [27]=false
2023.02.25-23:59:47.20@0:  bool [28]=true
2023.02.25-23:59:47.20@0:  bool [118]=true
2023.02.25-23:59:47.20@0:  bool [31]=false
2023.02.25-23:59:47.20@0:  bool [213]=false
2023.02.25-23:59:47.20@0:  bool [214]=true
2023.02.25-23:59:47.20@0:  bool [3207]=true
2023.02.25-23:59:47.20@0:  bool [1009]=true
2023.02.25-23:59:47.20@0:  bool [133]=true
2023.02.25-23:59:47.20@0:  bool [134]=false
2023.02.25-23:59:47.20@0:  bool [135]=true
2023.02.25-23:59:47.20@0:  bool [400]=false
2023.02.25-23:59:47.20@0:  bool [SYS_REPLYEXP]=true
2023.02.25-23:59:47.20@0:  bool [404]=false
2023.02.25-23:59:47.20@0:  bool [141]=false
2023.02.25-23:59:47.20@0:  bool [154]=false
2023.02.25-23:59:47.20@0:  bool [419]=true
2023.02.25-23:59:47.20@0:  bool [STD_DYNAMIC]=false
2023.02.25-23:59:47.20@0:  bool [STD_DISABLED]=true
2023.02.25-23:59:47.20@0:  bool [435]=true
2023.02.25-23:59:47.20@0:  bool [436]=true
2023.02.25-23:59:47.20@0:  u32 [net::2]=956184040 0x38fe35e8 232.53.254.56
2023.02.25-23:59:47.20@0:  u32 [net::3]=1 0x1 1.0.0.0
2023.02.25-23:59:47.20@0:  u32 [net::4]=2 0x2 2.0.0.0
2023.02.25-23:59:47.20@0:  u32 [73]=28 0x1c 28.0.0.0
2023.02.25-23:59:47.20@0:  u32 [STD_FILTER]=-91991056 0xfa8453f0 240.83.132.250
2023.02.25-23:59:47.20@0:  u32 [STD_PAGENO]=-193161230 0xf47c97f2 242.151.124.244
2023.02.25-23:59:47.20@0:  u32 [STD_DEAD]=1082238682 0x4081a6da 218.166.129.64
2023.02.25-23:59:47.20@0:  u32 [104]=-728225444 0xd498295c 92.41.152.212
2023.02.25-23:59:47.20@0:  u32 [114]=3 0x3 3.0.0.0
2023.02.25-23:59:47.20@0:  u32 [122]=507164031 0x1e3ab57f 127.181.58.30
2023.02.25-23:59:47.20@0:  u32 [7339]=-623798403 0xdad1977d 125.151.209.218
2023.02.25-23:59:47.20@0:  u32 [1004]=6 0x6 6.0.0.0
2023.02.25-23:59:47.20@0:  u32 [1005]=-1 0xffffffff 255.255.255.255
2023.02.25-23:59:47.20@0:  u32 [1006]=1 0x1 1.0.0.0
2023.02.25-23:59:47.20@0:  u32 [SYS_TYPE]=TYPE_REQUEST
2023.02.25-23:59:47.20@0:  u32 [132]=28 0x1c 28.0.0.0
2023.02.25-23:59:47.20@0:  u32 [133]=4 0x4 4.0.0.0
2023.02.25-23:59:47.20@0:  u32 [SYS_REQID]=9523 0x2533 51.37.0.0
2023.02.25-23:59:47.20@0:  u32 [SYS_CMD]=CMD_GETALL
2023.02.25-23:59:47.20@0:  u32 [SYS_ERRNO]=2 0x2 2.0.0.0
2023.02.25-23:59:47.20@0:  u32 [138]=1104327583 0x41d2b39f 159.179.210.65
2023.02.25-23:59:47.20@0:  u32 [SYS_POLICY]=524286 0x7fffe 254.255.7.0
2023.02.25-23:59:47.20@0:  u32 [143]=804711384 0x2ff6ebd8 216.235.246.47
2023.02.25-23:59:47.20@0:  u32 [SYS_USER_ID]=5171 0x1433 51.20.0.0
2023.02.25-23:59:47.20@0:  u32 [148]=-2 0xfffffffe 254.255.255.25
2023.02.25-23:59:47.20@0:
2023.02.25-23:59:47.20@0: logtail 1024 begin:
2023.02.25-23:59:47.20@0: trial
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:31.38@0: resetCounters for user ▒▒)V+V
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:31.38@0: resetCounters for user ▒#)V+V
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:34.67@0: resetCounters for user default-trial
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:34.67@0: resetCounters for user ▒▒)V+V
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:34.67@0: resetCounters for user ▒#)V+V
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:35.02@0: resetCounters for user default-trial
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:35.02@0: resetCounters for user ▒▒)V+V
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:35.02@0: resetCounters for user ▒#)V+V
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:38.29@0: resetCounters for user default-trial
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:38.29@0: resetCounters for user ▒▒)V+V
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:38.29@0: resetCounters for user ▒#)V+V
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:38.64@0: resetCounters for user default-trial
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:38.64@0: resetCounters for user ▒▒)V+V
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:38.64@0: resetCounters for user ▒#)V+V
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:42.01@0: resetCounters for user default-trial
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:42.02@0: resetCounters for user ▒▒)V+V
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:42.02@0: resetCounters for user ▒#)V+V
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:42.39@0: resetCounters for user default-trial
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:42.39@0: resetCounters for user ▒▒)V+V
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:42.39@0: resetCounters for user ▒#)V+V
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:45.73@0: resetCounters for user default-trial
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:45.73@0: resetCounters for user ▒▒)V+V
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:45.73@0: resetCounters for user ▒#)V+V
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:46.11@0: resetCounters for user default-trial
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:46.11@0: resetCounters for user ▒▒)V+V
2023.02.25-23:59:47.20@0: 2023.02.25-23:59:46.11@0: resetCounters for user ▒#)V+V
2023.02.25-23:59:47.20@0:
2023.02.25-23:59:47.20@0: logtail end
```



gdb information 

```
pwndbg> c
Continuing.

Program received signal SIGSEGV, Segmentation fault.
0x0805cc6b in ?? ()
LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA
───────────────────────────────────────────────────[ REGISTERS ]────────────────────────────────────────────────────
*EAX  0x0
*EBX  0x8089670 —▸ 0x80740b0 —▸ 0x805211a ◂— push   ebp
*ECX  0xb
*EDX  0x0
*EDI  0x7f995e08 —▸ 0x8089808 —▸ 0x808d2c0 ◂— 0x10
*ESI  0x7f995ea4 —▸ 0x808def8 ◂— 0x0
*EBP  0x7f995e28 —▸ 0x7f995e58 —▸ 0x7f995ec8 —▸ 0x7f995f28 —▸ 0x7f995f78 ◂— ...
*ESP  0x7f995dfc —▸ 0x7f995ea4 —▸ 0x808def8 ◂— 0x0
*EIP  0x805cc6b ◂— push   dword ptr [eax + 4]
─────────────────────────────────────────────────────[ DISASM ]─────────────────────────────────────────────────────
 ► 0x805cc6b    push   dword ptr [eax + 4]
   0x805cc6e    push   7
   0x805cc70    push   esi
   0x805cc71    call   0x804e0c0                     <0x804e0c0>
 
   0x805cc76    mov    eax, dword ptr [ebx + 0x78]
   0x805cc79    add    esp, 0x10
   0x805cc7c    cmp    dword ptr [eax], 0
   0x805cc7f    jne    0x805ce11                     <0x805ce11>
 
   0x805cc85    mov    edx, dword ptr [ebx + 0xb0]
   0x805cc8b    lea    eax, [edx + 0x20]
   0x805cc8e    test   edx, edx
─────────────────────────────────────────────────────[ STACK ]──────────────────────────────────────────────────────
00:0000│ esp 0x7f995dfc —▸ 0x7f995ea4 —▸ 0x808def8 ◂— 0x0
01:0004│     0x7f995e00 —▸ 0x8089670 —▸ 0x80740b0 —▸ 0x805211a ◂— push   ebp
02:0008│     0x7f995e04 ◂— 0x8
03:000c│ edi 0x7f995e08 —▸ 0x8089808 —▸ 0x808d2c0 ◂— 0x10
04:0010│     0x7f995e0c —▸ 0x808980e ◂— 0x100808
05:0014│     0x7f995e10 —▸ 0x807ee58 —▸ 0x8076b58 —▸ 0x80551c4 ◂— push   ebp
06:0018│     0x7f995e14 ◂— 0x0
07:001c│     0x7f995e18 —▸ 0x7f995e38 ◂— 0x5
───────────────────────────────────────────────────[ BACKTRACE ]────────────────────────────────────────────────────
 ► f 0 0x805cc6b
   f 1 0x77700a7c AMap::getDefaultCfg()+54
   f 2 0x777040c6
   f 3 0x776d5d80
   f 4 0x776d28aa nv::Handler::handle(nv::message&)+276
   f 5 0x776d4e6e nv::Looper::dispatchMessage(nv::message&)+408
   f 6 0x776d43fb
   f 7 0x776d0163 nv::ThinRunner::step(bool)+289
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
pwndbg> 
```

